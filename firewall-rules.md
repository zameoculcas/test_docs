## Правила ##
Правила межсетевого экранирования определяют, как Idustrial Firewall будет управлять проходящим через него трафиком.

Группа страниц графического интерфейса "Межсетевой экран - Правила" предоставляет инструменты для управления всеми правилами межсетевого экранирования Industrial Firewall. 

Все правила межсетевого экранирования сгруппированы в несколько списков правил.

Списки правил сгруппированы по области действия: 
* правила, действующие на отдельные сетевые интерфейсы; 
* правила, действующие на группы сетевых интерфейсов; 
* правила, действующие на все интерфейсы и сетевые группы (опционально).

Каждому списку правил посвящена отдельная страница графического интерфейса "Межсетевой экран - Правила". 

### Логика работы ###
Каждое правило межсетевого экранирования содержит набор критериев для сетевого пакета и действие, которое должно быть применено к сетевому пакету. 
Industrial Firewall для каждого сетевого пакета проверяет все активные правила межсетевого экранирования, выбирает из всех активных правил одно правило (правило-победитель) и выполняет над сетевым пакетом действие, указанное в правиле-победителе.

С целью удобства конфигурирования все правила межсетевого экранирования в интерфейсе Industrial Firewall организованы в списки правил.

Списки правил отличаются приоритетом (сперва будет выполнена проверка правил, находящихся в списке с более высоким приоритетом) и областью действия списка. 

Последовательность расположения правил в списках так же имеет значение, так как Industrial Firewall проверяет все правила в списке и проверку выполняет строго в направлении от первого правила к последнему. В общем случае из нескольких подходящих правил победителем будет выбрано то, которое расположено ближе конкурентов к концу списка, его действие будет выполнено над пакетом (побеждает последний подходящий).  

Указанный общий случай выбора правила-победителя на практике часто модифицирован доступными настройками Industrial Firewall, влияющими на порядок выбора правила-победителя, такими настройками являются: опция "Быстрая проверка", механизм отслеживания состояния соединений, группировка интерфейсов. Влияние различных настроек на порядок выбора правила-победителя подробно описано в разделе [Порядок выполнения](#порядок-выполнения).

#### Порядок выполнения ####
Как было указано в разеделе руководства [Логика работы](#логика-работы) внутри каждого списка правила проверяются в последовательности от начала списка к концу списка, при этом в Industrial Firewall всегда существует несколько списков правил (как минимум списки "Общие", "WAN", "LAN"), выбор списка для проверки его правил осуществляется в последовательности, изображенной на рисунке n.2.


```mermaid graph TD;

  id1( Общие ) --> id2( Группы интерфейсов ) --> ad3(Интерфейсы );
```


Рисунок n.2. Порядок проверки списков правил межсетевого экранирования


Первыми проверяются правила из списка Общие, затем проверяются правила из списков соответствующих групп интерфейсов, затем правила из списков интерфейсов.

Весь набор правил (из каждого списка), на соответствие которым проверяется пакет, может быть быть представлен как один большой результирующий список, структура и порядок обхода которого изображены на русунке n.3.

<div align="center"> 

![image Firewall-aliases](./2_images/2_Rules/3_Final_list.png) 

</div>

<div align="center">Рисунок n.3. 4_Final_list</div>

Исключение из правила "**побеждает последний выигравший**".

Полная проверка всех правил результирующего списка может быть остановлена на текущем правиле, если сетевой пакет соответствует критериям правила, и в правиле активна опция "Быстрая проверка". 

Опция "Быстрая проверка" означает, что правило проверка подошедшедшего под критерии правила пакета будет остановлена, и над пакетом будет выполнено действие, указанное в правиле.
